.PHONY: cleanup all

CFLAGS := -std=c99 -Wall -Werror -I. # NOTE: -O3 fails tests
VPATH := .:test
TESTS := $(patsubst %.c, %, $(wildcard test/*))

all: $(TESTS)

testrail-test.h: testrail.h
	touch $@

testrail.o: testrail.c testrail-test.h

selftest.o: selftest.c testrail-test.h

%.o: %.c testrail.h

test/%: %.o testrail.o
	$(CC) $^ -o $@
	./$@

cleanup:
	rm -f *.o $(TESTS)